<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaxy Shooter</title>
<style>
html, body {
    margin: 0;
    background: black;
    overflow: hidden;
}
#gameCanvas {
    display: block;
    background: black;
}
#ui {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    font-family: monospace;
    font-size: 20px;
    user-select: none;
}
#gameOver {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: monospace;
    font-size: 40px;
    text-align: center;
    display: none;
}
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="ui">Score: 0</div>
<div id="gameOver">
    <div>GAME OVER</div>
    <div style="font-size: 20px;">Press R to Restart</div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

// ============================
// GAME STATE
// ============================
let score = 0;
let gameOver = false;
let wave = 1;

// ============================
// PLAYER
// ============================
let player = {
    x: canvas.width/2,
    y: canvas.height - 80,
    width: 40,
    height: 40,
    speed: 7,
    rapid: false,
    shield: false,
    shieldTime: 0
};

// ============================
// BULLETS
// ============================
let bullets = [];

// ============================
// ENEMIES
// ============================
let enemies = [];

// ============================
// PARTICLES
// ============================
let particles = [];

// ============================
// STARS
// ============================
let stars = [];
for(let i=0; i<200; i++){
    stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:1+Math.random()*2, speed:0.2+Math.random()*0.8});
}

// ============================
// INPUT
// ============================
let left=false, right=false, shoot=false;
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') left=true;
    if(e.key==='ArrowRight') right=true;
    if(e.key===' ') shoot=true;
    if((e.key==='r' || e.key==='R') && gameOver) resetGame();
});
document.addEventListener('keyup', e=>{
    if(e.key==='ArrowLeft') left=false;
    if(e.key==='ArrowRight') right=false;
    if(e.key===' ') shoot=false;
});

// ============================
// RESET GAME
// ============================
function resetGame(){
    score=0;
    wave=1;
    bullets=[];
    enemies=[];
    particles=[];
    gameOver=false;
    player.x=canvas.width/2;
    player.rapid=false;
    player.shield=false;
    document.getElementById('gameOver').style.display='none';
}

// ============================
// SHOOT BULLETS
// ============================
function fireBullet(){
    if(player.rapid){
        bullets.push({x:player.x-10, y:player.y-20, width:5, height:15, speed:12});
        bullets.push({x:player.x+10, y:player.y-20, width:5, height:15, speed:12});
    } else {
        bullets.push({x:player.x, y:player.y-20, width:5, height:15, speed:12});
    }
}

// ============================
// SPAWN ENEMIES
// ============================
function spawnEnemy(type='basic'){
    let size = type==='basic'?40: type==='fast'?30:50;
    let speed = type==='basic'?2: type==='fast'?4:1.5;
    enemies.push({
        x: Math.random()*(canvas.width-size),
        y: -size,
        width: size,
        height: size,
        speed: speed,
        type: type,
        hp: type==='tank'?5:1
    });
}

// Spawn enemies every 1s
setInterval(()=>{
    if(!gameOver){
        let types=['basic','fast','tank'];
        let type = types[Math.floor(Math.random()*types.length)];
        spawnEnemy(type);
    }
}, 1000);

// ============================
// SPAWN POWER-UPS
// ============================
let powerUps = [];
function spawnPowerUp(){
    let types=['rapid','shield','score'];
    let type = types[Math.floor(Math.random()*types.length)];
    powerUps.push({
        x: Math.random()*(canvas.width-20),
        y: -20,
        width: 20,
        height: 20,
        type: type,
        speed:2
    });
}
setInterval(()=>{
    if(!gameOver && Math.random()<0.02){
        spawnPowerUp();
    }
}, 500);

// ============================
// PARTICLE EFFECT
// ============================
function createExplosion(x, y, color='orange'){
    for(let i=0; i<20; i++){
        particles.push({
            x, y,
            vx:(Math.random()-0.5)*4,
            vy:(Math.random()-0.5)*4,
            life:20+Math.random()*20,
            size:2+Math.random()*3,
            color: color
        });
    }
}

// ============================
// GAME LOOP
// ============================
function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw stars
    ctx.fillStyle='white';
    stars.forEach(s=>{
        ctx.globalAlpha=0.8;
        ctx.fillRect(s.x,s.y,s.size,s.size);
        s.y += s.speed;
        if(s.y>canvas.height){
            s.y=0; s.x=Math.random()*canvas.width;
        }
    });
    ctx.globalAlpha=1;

    if(!gameOver){
        // Player movement
        if(left) player.x-=player.speed;
        if(right) player.x+=player.speed;
        player.x=Math.max(player.width/2, Math.min(canvas.width-player.width/2, player.x));

        // Shooting
        if(shoot && bullets.length<10) fireBullet();

        // Move bullets
        bullets.forEach((b,i)=>{
            b.y-=b.speed;
            if(b.y<-20) bullets.splice(i,1);
        });

        // Draw bullets
        ctx.fillStyle='red';
        bullets.forEach(b=>ctx.fillRect(b.x-b.width/2, b.y-b.height, b.width, b.height));

        // Move enemies
        enemies.forEach((e,i)=>{
            e.y+=e.speed;

            // Check collision with bullets
            bullets.forEach((b,j)=>{
                if(b.x<b.x+e.width && b.x+b.width>e.x && b.y<b.y+e.height && b.y+b.height>e.y){
                    bullets.splice(j,1);
                    e.hp--;
                    if(e.hp<=0){
                        createExplosion(e.x+e.width/2,e.y+e.height/2);
                        enemies.splice(i,1);
                        score += e.type==='tank'?300:100;
                    }
                }
            });

            // Check collision with player
            if(player.x-player.width/2<e.x+e.width && player.x+player.width/2>e.x &&
               player.y-player.height/2<e.y+e.height && player.y+player.height/2>e.y){
                if(player.shield){
                    createExplosion(e.x+e.width/2,e.y+e.height/2,'blue');
                    enemies.splice(i,1);
                } else gameOver=true;
            }

            // Draw enemy
            ctx.fillStyle=e.type==='tank'?'purple':e.type==='fast'?'yellow':'lime';
            ctx.fillRect(e.x,e.y,e.width,e.height);
        });

        // Move power-ups
        powerUps.forEach((p,i)=>{
            p.y+=p.speed;

            // Collect power-up
            if(player.x-player.width/2<p.x+p.width && player.x+player.width/2>p.x &&
               player.y-player.height/2<p.y+p.height && player.y+player.height/2>p.y){
                if(p.type==='rapid') player.rapid=true;
                if(p.type==='shield') {player.shield=true; player.shieldTime=300;}
                if(p.type==='score') score+=500;
                powerUps.splice(i,1);
            }

            ctx.fillStyle=p.type==='rapid'?'cyan':p.type==='shield'?'blue':'gold';
            ctx.fillRect(p.x,p.y,p.width,p.height);
        });

        // Shield timer
        if(player.shield){
            player.shieldTime--;
            if(player.shieldTime<=0) player.shield=false;
        }

        // Draw player
        ctx.fillStyle=player.shield?'cyan':'white';
        ctx.beginPath();
        ctx.moveTo(player.x,player.y-player.height/2);
        ctx.lineTo(player.x-player.width/2,player.y+player.height/2);
        ctx.lineTo(player.x+player.width/2,player.y+player.height/2);
        ctx.closePath();
        ctx.fill();
    }

    // Draw particles
    particles.forEach((p,i)=>{
        p.x+=p.vx;
        p.y+=p.vy;
        p.life--;
        ctx.fillStyle=p.color;
        ctx.globalAlpha=p.life/40;
        ctx.fillRect(p.x,p.y,p.size,p.size);
        if(p.life<=0) particles.splice(i,1);
    });
    ctx.globalAlpha=1;

    // UI
    document.getElementById('ui').innerText="Score: "+score+" | Wave: "+wave;

    // Wave increase
    if(score>wave*1000) wave++;

    if(gameOver) document.getElementById('gameOver').style.display='block';

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
